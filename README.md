# MK_IR_I2C

åŸºæ–¼ STM32F030F4P6 æ‰€è¨­è¨ˆçš„ç´…å¤–ç·šæ„Ÿæ¸¬å™¨é™£åˆ—æ¨¡çµ„ï¼Œå…·å‚™ I2C é€šè¨Šèƒ½åŠ›ï¼Œå¯å¿«é€Ÿæ•´åˆè‡³å„é¡å‹æ©Ÿå™¨äººå¹³å°èˆ‡è‡ªå‹•åŒ–è¨­å‚™ä¸­ã€‚æ¨¡çµ„é€é CD74HC4067 å¤šå·¥å™¨è®€å– QRE1113GR æ„Ÿæ¸¬å™¨ï¼Œä¸¦å°‡è³‡æ–™ç¶“ I2C åŒ¯æµæ’å‚³é€è‡³ä¸»æ§æ¿ï¼ˆå¦‚ Arduino æˆ–å…¶ä»– MCUï¼‰ã€‚

## ğŸ› ï¸ ç¡¬é«”æ¶æ§‹

- **MCU**ï¼šSTM32F030F4P6
- **æ„Ÿæ¸¬å™¨**ï¼š16 é¡† QRE1113GR åå°„å¼ç´…å¤–ç·šæ„Ÿæ¸¬å™¨
- **é¡æ¯”å¤šå·¥å™¨**ï¼šCD74HC4067
- **IÂ²C ä»‹é¢**ï¼šSlave æ¨¡å¼ï¼Œæ”¯æ´æ¨™æº–èˆ‡é«˜é€Ÿæ¨¡å¼ï¼ˆ100kHz / 400kHzï¼‰
- **è¼¸å‡ºè³‡æ–™**ï¼šå¤šé€šé“åå°„å€¼ï¼Œå–®ä½ç‚º 8-bit æ•´æ•¸
- **æ“´å……æ€§**ï¼š
  - æ”¯æ´å¤šæ¨¡çµ„ä¸²æ¥ï¼ˆé€éä¸åŒ IÂ²C ä½å€ï¼‰
  - æ¯å€‹æ„Ÿæ¸¬å™¨å¯å–®ç¨è¨­å®šé–€æª»å€¼èˆ‡ä½¿èƒ½ç‹€æ…‹

## ğŸ“¦ è»Ÿé«”åŠŸèƒ½

- IÂ²C slave å¯¦ä½œï¼Œå¯æ¥æ”¶ä¸»æ©Ÿå‘½ä»¤èˆ‡å›å‚³æ„Ÿæ¸¬è³‡æ–™
- æ”¯æ´å‹•æ…‹è¨­å®šæ„Ÿæ¸¬å™¨åƒæ•¸ï¼ˆä½¿èƒ½/é–¾å€¼ï¼‰
- æ„Ÿæ¸¬è³‡æ–™è‡ªå‹•æƒæï¼ˆDMA + ADCï¼‰
- å…§å»º LED ç‹€æ…‹æŒ‡ç¤º

## ğŸ“‹ IÂ²C å¯„å­˜å™¨å°ç…§è¡¨ï¼ˆRegister Mapï¼‰

| åç¨±                      | åœ°å€ | æ¬Šé™     | å¤§å°     | èªªæ˜                                                  |
| ------------------------- | ---- | -------- | -------- | ----------------------------------------------------- |
| `REG_LED`                 | 0x01 | R/W (CB) | 2 bytes  | æ§åˆ¶è‡ªè¨‚ LED ç‹€æ…‹ï¼ˆ16-bitï¼‰ï¼Œè‡ªå‹•å•Ÿç”¨è‡ªè¨‚æ§åˆ¶         |
| `REG_LED_MODE_MASK`       | 0x02 | R/W      | 2 bytes  | LED æ§åˆ¶é®ç½©ï¼Œ1=è‡ªè¨‚æ§åˆ¶ï¼Œ0=ç”±é–¾å€¼è‡ªå‹•æ§åˆ¶            |
| `REG_READ_THRESHOLD_ONE`  | 0x13 | R (CB)   | 3 bytes  | è®€å–å–®ä¸€é€šé“é–¾å€¼ï¼Œæ ¼å¼ï¼š`[index] â†’ [index][LSB][MSB]` |
| `REG_WRITE_THRESHOLD_ONE` | 0x14 | W (CB)   | 3 bytes  | å¯«å…¥å–®ä¸€é€šé“é–¾å€¼ï¼Œæ ¼å¼ï¼š`[index][LSB][MSB]`           |
| `REG_THRESHOLD_ALL`       | 0x15 | R/W (CB) | 32 bytes | ä¸€æ¬¡è®€/å¯«å…¨éƒ¨ 16 é€šé“é–¾å€¼ï¼Œæ¯é€šé“ 2 bytes             |
| `REG_THRESHOLD_FLAG`      | 0x16 | R        | 2 bytes  | é–¾å€¼æ¯”è¼ƒæ——æ¨™ï¼ˆbitmaskï¼‰ï¼Œ1=è¶…éï¼Œ0=æœªè¶…é             |
| `REG_ADC_DATA`            | 0x29 | R        | 32 bytes | è®€å–æ‰€æœ‰é€šé“ ADC è³‡æ–™ï¼ˆ16 é€šé“ Ã— 2 bytesï¼‰            |
| `REG_ADC_DATA00`          | 0x30 | R        | 2 bytes  | é€šé“ 0 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA01`          | 0x31 | R        | 2 bytes  | é€šé“ 1 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA02`          | 0x32 | R        | 2 bytes  | é€šé“ 2 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA03`          | 0x33 | R        | 2 bytes  | é€šé“ 3 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA04`          | 0x34 | R        | 2 bytes  | é€šé“ 4 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA05`          | 0x35 | R        | 2 bytes  | é€šé“ 5 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA06`          | 0x36 | R        | 2 bytes  | é€šé“ 6 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA07`          | 0x37 | R        | 2 bytes  | é€šé“ 7 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA08`          | 0x38 | R        | 2 bytes  | é€šé“ 8 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA09`          | 0x39 | R        | 2 bytes  | é€šé“ 9 çš„ ADC æ•¸å€¼                                    |
| `REG_ADC_DATA10`          | 0x3A | R        | 2 bytes  | é€šé“ 10 çš„ ADC æ•¸å€¼                                   |
| `REG_ADC_DATA11`          | 0x3B | R        | 2 bytes  | é€šé“ 11 çš„ ADC æ•¸å€¼                                   |
| `REG_ADC_DATA12`          | 0x3C | R        | 2 bytes  | é€šé“ 12 çš„ ADC æ•¸å€¼                                   |
| `REG_ADC_DATA13`          | 0x3D | R        | 2 bytes  | é€šé“ 13 çš„ ADC æ•¸å€¼                                   |
| `REG_ADC_DATA14`          | 0x3E | R        | 2 bytes  | é€šé“ 14 çš„ ADC æ•¸å€¼                                   |
| `REG_ADC_DATA15`          | 0x3F | R        | 2 bytes  | é€šé“ 15 çš„ ADC æ•¸å€¼                                   |
| `REG_VERSION`             | 0xFE | R        | 2 bytes  | å›ºä»¶ç‰ˆæœ¬è™Ÿï¼ˆä¾‹å¦‚ `0x0102` è¡¨ç¤º v1.0.2ï¼‰               |
| `REG_LAST_ERROR`          | 0xFF | R        | 1 byte   | æœ€å¾ŒéŒ¯èª¤ä»£ç¢¼ï¼ˆè®€å–å¾Œè‡ªå‹•æ¸…é™¤ï¼‰                        |

> ğŸ’¡ **èªªæ˜**ï¼š
>
> - æ¬Šé™æ¬„ä½ï¼š`R` = Readã€`W` = Writeã€`CB` = é€é callback è™•ç†é‚è¼¯ã€‚
> - æ‰€æœ‰è³‡æ–™çš†ç‚ºå°ç«¯åºï¼ˆLittle Endianï¼‰ã€‚
